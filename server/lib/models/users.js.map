{"version":3,"sources":["models/users.js"],"names":[],"mappings":"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","file":"models/users.js","sourcesContent":["import _ from 'lodash';\nimport async from 'async';\nimport mongobless, {ObjectId} from 'mongobless';\nimport {oAuth2Client, oAuth2AccessToken, oAuth2RefreshToken} from './oauth2';\n\n@mongobless({collection: 'users'})\nexport class User{ \n    \n    static getAccessToken (bearerToken, callback) {\n        console.log('in getAccessToken (bearerToken: ' + bearerToken + ')');\n        \n        oAuth2AccessToken.findOne({accessToken: bearerToken}, callback);\n    }\n    \n    static getClient(clientId, clientSecret, callback) {\n        console.log('in getClient (clientId: ' + clientId + ', clientSecret: ' + clientSecret + ')');\n        \n        if (clientSecret === null) {\n            return oAuth2Client.findOne({clientId: clientId}, callback);\n        }\n        \n        oAuth2Client.findOne({id: clientId, secret: clientSecret}, (err, client) => {\n            if(err) return callback(err);\n            client.clientId = client.id;\n            callback(null, client);\n        });\n        \n    }\n    \n    static grantTypeAllowed(clientId, grantType, callback) {\n        console.log('in grantTypeAllowed (clientId: ' + clientId + ', grantType: ' + grantType + ')');\n\n        if (grantType === 'password' ||grantType === 'refresh_token') {\n            oAuth2Client.findOne({id: clientId, grant_types: grantType}, (err, client) => {\n                if(err) return callback(err);\n                \n                if(client.id == clientId) {\n                    callback(false, true);\n                } else {\n                    callback(false, false);\n                }\n            });\n            \n        } else {\n            callback(false, false);\n        }\n\n    }\n    \n    static saveAccessToken(accessToken, clientId, expires, user, callback) {\n        console.log('in saveAccessToken (token: ' + accessToken + ', clientId: ' + clientId + ', userId: ' + user.id + ', expires: ' + expires + ')');\n\n        let token = {accessToken: accessToken, clientId: clientId, expires:expires, userId: user.id};\n        \n        oAuth2AccessToken.collection.insert(token, callback);\n        \n    }\n    \n    static saveRefreshToken (token, clientId, expires, user, callback) {\n        console.log('in saveRefreshToken (token: ' + token + ', clientId: ' + clientId + ', userId: ' + user.id + ', expires: ' + expires + ')');\n    \n        let refreshToken = {\n            refreshToken: token,\n            clientId: clientId,\n            userId: user.id,\n            expires: expires\n        }\n        \n        oAuth2RefreshToken.collection.insert(refreshToken, callback); \n    \n    };\n    \n    static getRefreshToken (refreshToken, callback) {\n        console.log('in getRefreshToken (refreshToken: ' + refreshToken + ')');\n    \n        oAuth2RefreshToken.findOne({refreshToken: refreshToken}, callback);\n    \n    };\n    \n    static getUser(username, password, callback) {\n        console.log('in getUser (username: ' + username + ', password: ' + password + ')');\n        User.findOne({username: username, password: password }, (err, user) => {\n            if(err) return callback(err);\n            user.id = user._id + \"\";\n            callback(null, user);\n        }); \n        \n    }\n\n    \n}\n"],"sourceRoot":"/home/redpelicans/timetrack/server/src"}